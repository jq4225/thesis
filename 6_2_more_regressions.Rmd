---
title: "6_2_more_regressions"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(lfe)
library(texreg)
library(broom)
library(tidyverse)
```

```{r}
# hps_all_v17

hps_all_v18 <- hps_all_v18 %>% 
  mutate(c1_2 = ifelse(c1_school_closing > 1, 1, 0),
         c2_2 = ifelse(c2_workplace_closing > 1, 1, 0),
         c6_2 = ifelse(c6_stay_at_home_requirements > 1, 1, 0))
```

```{r}
# Verification for like any lockdown

depression_1 <- felm(log(hps_depression) ~ c1 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

depression_2 <- felm(log(hps_depression) ~ c2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v17 %>% drop_na(pop),
             weights = na.omit(hps_all_v17$pop))

depression_3 <- felm(log(hps_depression) ~ c6 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v17 %>% drop_na(pop),
             weights = na.omit(hps_all_v17$pop))


anxiety_1 <- felm(log(hps_anxiety) ~ c1 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v17 %>% drop_na(pop),
             weights = na.omit(hps_all_v17$pop))

anxiety_2 <- felm(log(hps_anxiety) ~ c2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v17 %>% drop_na(pop),
             weights = na.omit(hps_all_v17$pop))

anxiety_3 <- felm(log(hps_anxiety) ~ c6 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v17 %>% drop_na(pop),
             weights = na.omit(hps_all_v17$pop))

htmlreg(l = list(depression_1, depression_2, depression_3,
                 anxiety_1, anxiety_2, anxiety_3),
        include.ci = FALSE, digits = 4, file = "hps.doc")
```


```{r}
depression_1 <- felm(log(hps_depression) ~ c1_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

depression_2 <- felm(log(hps_depression) ~ c2_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

depression_3 <- felm(log(hps_depression) ~ c6_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))


anxiety_1 <- felm(log(hps_anxiety) ~ c1_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

anxiety_2 <- felm(log(hps_anxiety) ~ c2_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

anxiety_3 <- felm(log(hps_anxiety) ~ c6_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

htmlreg(l = list(depression_1, depression_2, depression_3,
                 anxiety_1, anxiety_2, anxiety_3),
        include.ci = FALSE, digits = 4, file = "hps.doc")
```

```{r}

depression_1 <- felm(log(hps_depression) ~ c1 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

depression_1 <- felm(log(hps_depression) ~ c1_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

depression_1 <- felm(log(hps_depression) ~ c1_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))
```


```{r}
# Residuals

depression_1 <- felm(log(hps_depression) ~ c1_school_closing +
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v17 %>% drop_na(pop),
             weights = na.omit(hps_all_v17$pop))

residuals <- resid(depression_1)

hps_all_v17 %>% 
  drop_na(pop, hps_depression, c1_school_closing, e2_debt_contract_relief,
          covid_norm, lockdown_norm) %>% 
  ggplot(aes(x = period, y = residuals)) + geom_point()

plot(depression_1$fitted.values,
     depression_1$residuals)
```

```{r}
depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v23_5$pop),
                  data = searches_norm3_v23_5 %>% filter(is.na(pop) == FALSE))

depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma,
                  data = searches_norm3_v23_5)



searches_norm3_v23_5 %>% 
  drop_na(busclose_first, busopen_most_pop, pop) %>% 
  ggplot(aes(x = date, y = residuals)) + geom_point()

searches_norm3_v23_5 %>% 
  drop_na(busclose_first, busopen_most_pop, pop) %>% 
  ggplot(aes(x = depression, y = residuals)) + geom_point()

plot(x = depression_bus$response, 
           y = depression_bus$residuals)
```

```{r}
# Let's check out coding lockdown as only > 2

depression_1 <- felm(log(hps_depression) ~ c6_post_2only + c6_future_2 + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v18 %>% drop_na(pop),
             weights = na.omit(hps_all_v18$pop))

```

```{r}
depression_1 <- felm(log(hps_depression) ~ factor(c1_school_closing) * mental_health_provider_rate + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(period) + factor(state) + factor(year)|0|state,
             data = hps_all_v19 %>% drop_na(pop),
             weights = na.omit(hps_all_v19$pop))
```

```{r}
anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_first * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v23_5$pop),
                  data = searches_norm3_v23_5 %>% filter(is.na(pop) == FALSE))
```

```{r}
depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_first * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                  busclose_first:year_indicator:black_pct + 
                busopen_first:year_indicator:black_pct + 
                        online_only:year_indicator:black_pct + 
                        hybrid:year_indicator:black_pct + 
                        other:year_indicator:black_pct + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v23_5$pop),
                  data = searches_norm3_v23_5 %>% filter(is.na(pop) == FALSE))

```

```{r}
depression_bus <- felm(I(log(suicide + 1 )) ~  
                 sip_first * year_indicator + 
               no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v23_5$pop),
                  data = searches_norm3_v23_5 %>% filter(is.na(pop) == FALSE))

```

```{r}
# trying month FEs

depression_1 <- felm(log(hps_depression) ~ factor(c1_school_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)):factor(state) + factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop),
             weights = na.omit(hps_all_v25$pop))

depression_2 <- felm(log(hps_depression) ~ factor(c2_workplace_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)):factor(state) + factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop),
             weights = na.omit(hps_all_v25$pop))

depression_3 <- felm(log(hps_depression) ~ factor(c6_stay_at_home_requirements) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)):factor(state) + factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop),
             weights = na.omit(hps_all_v25$pop))

anxiety_1 <- felm(log(hps_anxiety) ~ factor(c1_school_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)):factor(state) + factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop),
             weights = na.omit(hps_all_v25$pop))

anxiety_2 <- felm(log(hps_anxiety) ~ factor(c2_workplace_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)):factor(state) + factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop),
             weights = na.omit(hps_all_v25$pop))

anxiety_3 <- felm(log(hps_anxiety) ~ factor(c6_stay_at_home_requirements) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)):factor(state) + factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop),
             weights = na.omit(hps_all_v25$pop))

htmlreg(l = list(depression_1, depression_2, depression_3, anxiety_1,
                 anxiety_2, anxiety_3), digits = 4, include.ci = FALSE,
        file = "hps.doc")


```

```{r}
# Month, no weighting

depression_1 <- felm(log(hps_depression) ~ factor(c1_school_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)) + factor(state):factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop),
             weights = na.omit(hps_all_v25$pop))

depression_2 <- felm(log(hps_depression) ~ factor(c2_workplace_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)) + factor(state):factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop))

depression_3 <- felm(log(hps_depression) ~ factor(c6_stay_at_home_requirements) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date)) + factor(state):factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop))

anxiety_1 <- felm(log(hps_anxiety) ~ factor(c1_school_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date))+ factor(state):factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop))

anxiety_2 <- felm(log(hps_anxiety) ~ factor(c2_workplace_closing) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date))+ factor(state):factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop))

anxiety_3 <- felm(log(hps_anxiety) ~ factor(c6_stay_at_home_requirements) + 
               initclaims_combined + 
               contclaims_combined + cases_per_100k_5day + 
               factor(e1_income_support) + factor(e2_debt_contract_relief) + 
                log(covid_norm+1) + log(lockdown_norm+1)
             |factor(month(start_date))+ factor(state):factor(year)|0|state,
             data = hps_all_v25 %>% drop_na(pop))

htmlreg(l = list(depression_1, depression_2, depression_3, anxiety_1,
                 anxiety_2, anxiety_3), digits = 4, include.ci = FALSE,
        file = "hps.doc")
```

```{r}
# DMA-year FEs
depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index, anxiety_sip, anxiety_sip_index),
        include.ci = FALSE, digits = 4, file = "sip.doc")
```


```{r}
depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))



anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index, anxiety_bus, anxiety_bus_index),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
# Therapy

therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator + 
               no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip),
        include.ci = FALSE, digits = 4, file = "bus.doc")

```


```{r}
# Trying for substances

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# Depression and anxiety, SIPs

depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))



anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index, anxiety_sip, anxiety_sip_index),
        include.ci = FALSE, digits = 4, file = "sip.doc")
```

```{r}
# depression/anxiety bus unweighted

depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma,
                  data = searches_norm3_v25_5)

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)



anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

htmlreg(l = list(depression_bus, depression_bus_index, anxiety_bus, anxiety_bus_index),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
# staggered DID
depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first:year_indicator + 
                busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first:year_indicator + 
                busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))



anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index, anxiety_bus, anxiety_bus_index),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))



anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index, anxiety_bus, anxiety_bus_index),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
# unadjusted

depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))



anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index, anxiety_bus, anxiety_bus_index),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
# depression/anxiety sip unweighted

depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma,
                  data = searches_norm3_v25_5)

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)



anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

htmlreg(l = list(depression_sip, depression_sip_index, anxiety_sip, anxiety_sip_index),
        include.ci = FALSE, digits = 4, file = "sip.doc")
```

```{r}
# staggered DID
depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first:year_indicator + 
                no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first:year_indicator + 
                no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))



anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index, anxiety_sip, anxiety_sip_index),
        include.ci = FALSE, digits = 4, file = "sip.doc")
```

```{r}
depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))



anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index, anxiety_sip, anxiety_sip_index),
        include.ci = FALSE, digits = 4, file = "sip.doc")
```

```{r}
# unadjusted

depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator + 
                no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))



anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index, anxiety_sip, anxiety_sip_index),
        include.ci = FALSE, digits = 4, file = "sip.doc")
```

```{r}
# Redoing the therapy regressions - unweighted

therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5 )

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator + 
               no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              data = searches_norm3_v25_5 )

htmlreg(l = list(therapy_bus, therapy_sip),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
# staggered did

therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first:year_indicator + 
                busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator + 
               no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
# all dmas
therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator + 
               no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}

# unadjusted

therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator + 
                busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator + 
               no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip),
        include.ci = FALSE, digits = 4, file = "bus.doc")
```

```{r}
# Substances unweighted

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# staggered
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# all DMAs
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# unadjusted
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# Substances unweighted -- SIPs

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# staggered
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# all DMAs
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# unadjusted
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```


```{r}
# original sip

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(cigarette + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(e_cig + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_5 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_6 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4, drugs_5, drugs_6),
        include.ci = FALSE,
        digits = 4,
        file = "drugs.doc")
```

```{r}
# substance misuse unweighted

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_8 <- felm(log(addiction + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_9 <- felm(log(rehab + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# staggered

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first:year_indicator + 
                                     busopen_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# all dmas

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# unadjusted 

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator + 
                                     busopen_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# SIP original

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```
```{r}
# substance misuse unweighted

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_8 <- felm(log(addiction + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_9 <- felm(log(rehab + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            data = searches_norm3_v25_5)

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             data = searches_norm3_v25_5)

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# staggered

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first:year_indicator + 
                                     no_sip_most_pop:year_indicator + 
                        online_only:year_indicator + 
                        hybrid:year_indicator + 
                        other:year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# all dmas

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v22$pop),
                  data = searches_norm3_v22 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# unadjusted 

drugs_7 <- felm(log(alcoholism + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_8 <- felm(log(addiction + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_9 <- felm(log(rehab + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_10 <- felm(log(substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

drugs_11 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator + 
                                     no_sip_most_pop * year_indicator + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_v24_5$pop),
                  data = searches_v24_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_7, drugs_8, drugs_9, drugs_10, drugs_11), digits = 4, include.ci = FALSE,
        file = "addiction.doc")
```

```{r}
# Heterogeneous treatment for black -- depression/anxiety

depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator * black_pct + 
                busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator * black_pct + 
                busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator * black_pct + 
                                     busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator * black_pct + 
                                     busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index,
                 anxiety_bus, anxiety_bus_index), include.ci = FALSE, digits = 4,
        file = "bus.doc")
```

```{r}
depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator * black_pct + 
                no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator * black_pct + 
                no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator * black_pct + 
                                     no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator * black_pct + 
                                     no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index,
                 anxiety_sip, anxiety_sip_index), include.ci = FALSE, digits = 4,
        file = "sip.doc")
```

```{r}
# Heterogeneous treatment for white -- depression/anxiety

depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator * white_pct + 
                busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator * white_pct + 
                busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator * white_pct + 
                                     busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator * white_pct + 
                                     busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index,
                 anxiety_bus, anxiety_bus_index), include.ci = FALSE, digits = 4,
        file = "bus.doc")
```

```{r}
depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator * white_pct + 
                no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator * white_pct + 
                no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator * white_pct + 
                                     no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator * white_pct + 
                                     no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index,
                 anxiety_sip, anxiety_sip_index), include.ci = FALSE, digits = 4,
        file = "sip.doc")
```

```{r}
# Heterogeneous treatment for pop den -- depression/anxiety

depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator * I(median_income/1000) + 
                busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator * I(median_income/1000) + 
                busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index,
                 anxiety_bus, anxiety_bus_index), include.ci = FALSE, digits = 4,
        file = "bus.doc")
```

```{r}
depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator * I(median_income/1000) + 
                no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator * I(median_income/1000) + 
                no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index,
                 anxiety_sip, anxiety_sip_index), include.ci = FALSE, digits = 4,
        file = "sip.doc")
```

```{r}
# Heterogeneous treatment for pop den -- depression/anxiety

depression_bus <- felm(I(log(depression + 1 )) ~  
                 busclose_first * year_indicator * I(median_income/1000) + 
                busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus <- felm(I(log(anxiety + 1 )) ~  
                 busclose_first * year_indicator * I(median_income/1000) + 
                busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_bus_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_bus_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_bus, depression_bus_index,
                 anxiety_bus, anxiety_bus_index), include.ci = FALSE, digits = 4,
        file = "bus.doc")
```

```{r}
depression_sip <- felm(I(log(depression + 1 )) ~  
                 sip_first * year_indicator * I(median_income/1000) + 
                no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip <- felm(I(log(anxiety + 1 )) ~  
                 sip_first * year_indicator * I(median_income/1000) + 
                no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

depression_sip_index <- felm(I(log(0.485 * crying + 0.782 * depression + 
                                0.127 * lonely + 0.320 * sad + 0.184 * tired + 1)) ~ 
                                     sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
            weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

anxiety_sip_index <- felm(I(log(0.924 * anxiety + 0.213 * nervous + 
                                0.133 * stress + 0.198 * worry + 0.211 * panic + 1)) ~ 
                                  sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(depression_sip, depression_sip_index,
                 anxiety_sip, anxiety_sip_index), include.ci = FALSE, digits = 4,
        file = "sip.doc")
```

```{r}
# Therapy heterogeneous effects

therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator * black_pct + 
                busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator * black_pct + 
                no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip), include.ci = FALSE, digits = 4,
        file = "therapy.doc")
```

```{r}
therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator * white_pct + 
                busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator * white_pct + 
                no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip), include.ci = FALSE, digits = 4,
        file = "therapy.doc")
```

```{r}
therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator * I(pop_den/100) + 
                busopen_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator * I(pop_den/100) + 
                no_sip_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip), include.ci = FALSE, digits = 4,
        file = "therapy.doc")
```

```{r}
therapy_bus <- felm(I(log(therapy + 1 )) ~  
                 busclose_first * year_indicator * I(median_income/1000) + 
                busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

therapy_sip <- felm(I(log(therapy + 1 )) ~  
                 sip_first * year_indicator * I(median_income/1000) + 
                no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(therapy_bus, therapy_sip), include.ci = FALSE, digits = 4,
        file = "therapy.doc")
```

```{r}
# Drugs 

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator * black_pct + 
                                     busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator * black_pct + 
                                     busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator * black_pct + 
                                     busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator * black_pct + 
                                     busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator * black_pct + 
                                     no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator * black_pct + 
                                     no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator * black_pct + 
                                     no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator * black_pct + 
                                     no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
# Drugs 

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator * white_pct + 
                                     busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator * white_pct + 
                                     busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator * white_pct + 
                                     busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator * white_pct + 
                                     busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator * white_pct + 
                                     no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator * white_pct + 
                                     no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator * white_pct + 
                                     no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator * white_pct + 
                                     no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
# Drugs 

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator * I(pop_den/100) + 
                                     busopen_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator * I(pop_den/100) + 
                                     busopen_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator * I(pop_den/100) + 
                                     busopen_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator * I(pop_den/100) + 
                                     busopen_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator * I(pop_den/100) + 
                                     no_sip_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator * I(pop_den/100) + 
                                     no_sip_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator * I(pop_den/100) + 
                                     no_sip_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator * I(pop_den/100) + 
                                     no_sip_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
# Drugs 

drugs_1 <- felm(log(alcohol + 1) ~ 
                                  busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
drugs_1 <- felm(log(alcohol + 1) ~ 
                                  sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(cannabis + 1) ~ 
                                  sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))


drugs_3 <- felm(log(e_cig + cigarette + smoking + 1) ~ 
                                  sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.144 * alcohol + 0.833 * cannabis + 0.451 * cigarette + 
                            0.172 * e_cig + 0.228 * smoking + 1) ~ 
                                  sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
             weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
# Ew

drugs_1 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator * black_pct + 
                                     busopen_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator * white_pct + 
                                     busopen_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator * I(pop_den/100) + 
                                     busopen_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  busclose_first * year_indicator * I(median_income/1000) + 
                                     busopen_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```

```{r}
drugs_1 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator * black_pct + 
                                     no_sip_most_pop * year_indicator * black_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_2 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator * white_pct + 
                                     no_sip_most_pop * year_indicator * white_pct + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_3 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator * I(pop_den/100) + 
                                     no_sip_most_pop * year_indicator * I(pop_den/100) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

drugs_4 <- felm(log(0.308 * addiction + 0.390 * alcoholism + 0.104 * rehab + 
                             0.861 * substance_abuse + 1) ~ 
                                  sip_first * year_indicator * I(median_income/1000) + 
                                     no_sip_most_pop * year_indicator * I(median_income/1000) + 
                        online_only * year_indicator + 
                        hybrid * year_indicator + 
                        other * year_indicator + 
                        cases_per_100k + unemploy_rate + temp + precip + 
                       log(lockdown + 1) + log(covid + 1) + 
                       factor(income_support) + factor(debt_contract_relief)
                       |factor(week) + factor(dma):factor(year)|0|dma, 
              weights = na.omit(searches_norm3_v25_5$pop),
                  data = searches_norm3_v25_5 %>% filter(is.na(pop) == FALSE))

htmlreg(l = list(drugs_1, drugs_2, drugs_3, drugs_4), include.ci = FALSE, digits = 4, 
        file = "drugs.doc")
```


