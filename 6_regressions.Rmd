---
title: "5_regressions"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lfe)
library(texreg)
library(fixest)
```

```{r}
searches_v7 <- readRDS('clean_data/search/searches_v9.rds')

# Let's fuck around a bit and se what happens

searches_postlockdown <- searches_norm3 %>%
  filter(week >= 15)
```

```{r}
# Percentage of zeroes

zero_percent <- searches_norm3_v3 %>%
  group_by(dma) %>%
  select(dma, `alcohol`:`worry`, depression) %>% 
  summarize(across(.cols = c(`alcohol`:`worry`, depression), ~ sum(.==0)),
            weeks = n()) %>%
  mutate(across(.cols = c(`alcohol`:`depression`), ~ . * 100 / weeks)) %>%
  group_by(dma) %>%
  mutate(mean = mean(`alcohol`:`depression`))

zero_percent_summary <- zero_percent %>%
  summarize(across(.cols = `alcohol`:`depression`, mean))

less_than_15 <- zero_percent %>%
  filter(mean <= 15) %>%
  select(dma)

less_than_15 <- c(less_than_15$dma)

# testing anchor index too 

zero_percent_anchor <- anchor_index %>%
  group_by(dma) %>%
  select(dma, `honey`:`japan`) %>% 
  summarize(across(.cols = c(`honey`:`japan`), ~ sum(.==0)),
            weeks = n()) %>%
  mutate(across(.cols = c(`honey`:`japan`), ~ . * 100 / weeks))

zero_summary_anchor <- zero_percent_anchor %>%
  summarize(across(.cols = `honey`:`japan`, mean)) %>%
  pivot_longer(cols = `honey`:`japan`, names_to = "term", values_to= "zero_percent")

# Maybe I should revise the anchor index adjusted terms

```

```{r}
# Run only regressions with less than 15 percent zeroes on average?

searches_norm3_v3_15 <- searches_norm3_v3 %>%
  filter(dma %in% less_than_15)
```


```{r}
# read in searches v4 or later

test <- felm(I(log(depression + 1)) ~  sip_first * year_indicator + 
               deaths_per_100k + cases_per_100k +  
               unemploy_rate + economic_support_index|factor(dma):factor(year) + week|0|dma, 
             data = searches_v9)

test3 <-  felm(I(log(cigarette + 1)) ~  sip_first * year_indicator + 
               cases_per_100k +
                 unemploy_rate + factor(debt_contract_relief) + factor(income_support) + 
                 precip + temp|
                 factor(dma):factor(year) + factor(week)|0|dma, 
             data = searches_norm3_v4)

test3 <-  felm(I(suicide) ~  sip_first * year_indicator + 
               deaths_per_100k + cases_per_100k +  
               unemploy_rate + economic_support_index|factor(dma):factor(year) + week|0|dma, 
             data = searches_norm3)
```


